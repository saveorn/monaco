<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Custom Monaco UI</title>

<style>
body {
    margin: 0;
    overflow: hidden;
    font-family: Consolas, monospace;
    background: #0f1117;
}

/* Background image */
.background {
    position: fixed;
    inset: 0;
    background: url("https://i.pinimg.com/1200x/7c/85/af/7c85af6d58f6dc7e7e837ee8abaf6656.jpg") center center / cover no-repeat;
    opacity: 0.06;
    filter: blur(4px);
    z-index: 0;
}

/* Top bar */
.topbar {
    position: relative;
    height: 45px;
    background: #161a22;
    display: flex;
    align-items: center;
    padding: 0 10px;
    border-bottom: 1px solid #222;
    z-index: 2;
}

/* Tabs */
.tabs {
    display: flex;
    gap: 6px;
}

.tab {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 14px;
    background: #1c212b;
    color: #aaa;
    border-radius: 6px 6px 0 0;
    cursor: pointer;
    user-select: none;
}

.tab.active {
    background: #0f1117;
    color: white;
}

.close-btn {
    font-size: 13px;
    opacity: 0.6;
    cursor: pointer;
}

.close-btn:hover {
    opacity: 1;
}

/* Context menu */
.context-menu {
    position: absolute;
    background: #1c212b;
    border: 1px solid #333;
    border-radius: 6px;
    padding: 6px 0;
    display: none;
    z-index: 10;
    width: 140px;
}

.context-menu div {
    padding: 8px 12px;
    cursor: pointer;
    color: #ccc;
}

.context-menu div:hover {
    background: #2a2f3a;
}

/* Editor */
#editor {
    position: relative;
    width: 100%;
    height: calc(100vh - 46px);
    z-index: 1;
}

/* Make Monaco transparent */
.monaco-editor,
.monaco-editor-background,
.monaco-editor .margin {
    background: transparent !important;
}
</style>
</head>
<body>

<div class="background"></div>

<div class="topbar">
    <div class="tabs" id="tabs"></div>
</div>

<div id="editor"></div>

<div class="context-menu" id="contextMenu">
    <div onclick="renameTab()">Rename</div>
    <div onclick="closeTab()">Close</div>
</div>

<script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js"></script>
<script>
require.config({ paths: { vs: 'https://unpkg.com/monaco-editor@0.45.0/min/vs' }});

let editor;
let models = {};
let activeTab = null;
let contextTarget = null;

require(["vs/editor/editor.main"], function () {

    monaco.editor.defineTheme("transparent-dark", {
        base: "vs-dark",
        inherit: true,
        rules: [],
        colors: {
            "editor.background": "#00000000",
            "editorGutter.background": "#00000000"
        }
    });

    editor = monaco.editor.create(document.getElementById("editor"), {
        value: "",
        language: "lua",
        theme: "transparent-dark",
        fontSize: 14,
        minimap: { enabled: false },
        automaticLayout: true
    });

    createTab("untitled1.lua");
});

function createTab(name) {
    const model = monaco.editor.createModel("", "lua");
    models[name] = model;

    const tab = document.createElement("div");
    tab.className = "tab active";
    tab.innerHTML = `<span class="title">${name}</span><span class="close-btn">âœ•</span>`;

    tab.onclick = () => switchTab(name);

    tab.querySelector(".close-btn").onclick = (e) => {
        e.stopPropagation();
        removeTab(name);
    };

    tab.oncontextmenu = (e) => {
        e.preventDefault();
        contextTarget = name;
        showContextMenu(e.pageX, e.pageY);
    };

    document.getElementById("tabs").appendChild(tab);
    switchTab(name);
}

function switchTab(name) {
    activeTab = name;
    editor.setModel(models[name]);

    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".tab").forEach(t => {
        if (t.querySelector(".title").innerText === name) {
            t.classList.add("active");
        }
    });
}

function removeTab(name) {
    if (!models[name]) return;

    models[name].dispose();
    delete models[name];

    document.querySelectorAll(".tab").forEach(t => {
        if (t.querySelector(".title").innerText === name) {
            t.remove();
        }
    });

    const remaining = Object.keys(models);
    if (remaining.length > 0) {
        switchTab(remaining[0]);
    } else {
        editor.setModel(null);
    }
}

function renameTab() {
    const newName = prompt("Rename file:", contextTarget);
    if (!newName || models[newName]) return;

    models[newName] = models[contextTarget];
    delete models[contextTarget];

    document.querySelectorAll(".tab").forEach(t => {
        if (t.querySelector(".title").innerText === contextTarget) {
            t.querySelector(".title").innerText = newName;
        }
    });

    activeTab = newName;
    hideContextMenu();
}

function closeTab() {
    removeTab(contextTarget);
    hideContextMenu();
}

function showContextMenu(x, y) {
    const menu = document.getElementById("contextMenu");
    menu.style.left = x + "px";
    menu.style.top = y + "px";
    menu.style.display = "block";
}

function hideContextMenu() {
    document.getElementById("contextMenu").style.display = "none";
}

document.addEventListener("click", hideContextMenu);
</script>

</body>
</html>
