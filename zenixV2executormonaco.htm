<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lua Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            height: 100vh;
            overflow: hidden;
        }

        .editor-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: #000;
        }

        .tabs-wrapper {
            background: #050505;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #111;
            position: relative;
        }

        .scroll-btn {
            background: #0a0a0a;
            border: none;
            width: 24px;
            height: 100%;
            min-height: 32px;
            color: #333;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            transition: all 0.1s ease;
            flex-shrink: 0;
            z-index: 10;
        }

        .scroll-btn:hover {
            background: #111;
            color: #666;
        }

        .scroll-btn.visible {
            display: flex;
        }

        .scroll-btn-left {
            border-right: 1px solid #111;
        }

        .scroll-btn-right {
            border-left: 1px solid #111;
        }

        .tabs-container {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 8px;
            overflow-x: auto;
            flex: 1;
            scrollbar-width: none;
            -ms-overflow-style: none;
            scroll-behavior: smooth;
        }

        .tabs-container::-webkit-scrollbar {
            display: none;
        }

        .tab {
            background: #0a0a0a;
            padding: 5px 10px;
            border-radius: 6px;
            color: #3a3a3a;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.1s ease;
            border: 1px solid transparent;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .tab:hover {
            background: #111;
            color: #555;
        }

        .tab.active {
            background: #111;
            color: #666;
            border-color: #1a1a1a;
        }

        .tab-close {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            border: none;
            background: transparent;
            color: #2a2a2a;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            transition: all 0.1s ease;
            padding: 0;
            opacity: 0;
        }

        .tab:hover .tab-close {
            opacity: 1;
        }

        .tab-close:hover {
            background: #222;
            color: #888;
        }

        .tab.modified .tab-name::after {
            content: '•';
            margin-left: 4px;
            color: #333;
        }

        .add-tab {
            background: transparent;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            color: #222;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .add-tab:hover {
            background: #111;
            color: #444;
        }

        #editor {
            flex: 1;
            overflow: hidden;
            background: #050505;
        }

        .arrow-icon {
            width: 10px;
            height: 10px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <div class="tabs-wrapper">
            <button class="scroll-btn scroll-btn-left" id="scrollLeft">
                <svg class="arrow-icon" viewBox="0 0 24 24">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>
            <div class="tabs-container" id="tabsContainer">
                <button class="add-tab" id="addTabBtn">+</button>
            </div>
            <button class="scroll-btn scroll-btn-right" id="scrollRight">
                <svg class="arrow-icon" viewBox="0 0 24 24">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </button>
        </div>
        <div id="editor"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <script>
        require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' } });

        let editor;
        let tabs = [];
        let activeTabId = null;

        const defaultCode = `-- New Script
local function main()
    print("Hello World")
end

main()`;

        const tabsContainer = document.getElementById('tabsContainer');
        const scrollLeftBtn = document.getElementById('scrollLeft');
        const scrollRightBtn = document.getElementById('scrollRight');

        function saveToStorage() {
            localStorage.setItem('lua_editor_data', JSON.stringify({ tabs, activeTabId }));
        }

        function loadFromStorage() {
            const saved = localStorage.getItem('lua_editor_data');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    if (data.tabs?.length > 0) {
                        tabs = data.tabs;
                        activeTabId = data.activeTabId || tabs[0].id;
                        return true;
                    }
                } catch (e) {}
            }
            return false;
        }

        function getNextId() {
            return tabs.length > 0 ? Math.max(...tabs.map(t => t.id)) + 1 : 1;
        }

        function renumberTabs() {
            tabs.forEach((tab, i) => tab.name = `script${i + 1}.lua`);
            saveToStorage();
        }

        function createTab(content) {
            return {
                id: getNextId(),
                name: `script${tabs.length + 1}.lua`,
                content: content || defaultCode,
                modified: false
            };
        }

        function initTabs() {
            if (!loadFromStorage()) {
                tabs.push(createTab(defaultCode));
                activeTabId = tabs[0].id;
                saveToStorage();
            }
        }

        function updateScrollButtons() {
            const { scrollLeft, scrollWidth, clientWidth } = tabsContainer;
            scrollLeftBtn.classList.toggle('visible', scrollLeft > 0);
            scrollRightBtn.classList.toggle('visible', scrollLeft < scrollWidth - clientWidth - 1);
        }

        function scrollTabs(direction) {
            const scrollAmount = 150;
            tabsContainer.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
        }

        function scrollToActiveTab() {
            const activeEl = tabsContainer.querySelector('.tab.active');
            if (activeEl) {
                activeEl.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'nearest' });
            }
        }

        function updateTabUI() {
            const addBtn = document.getElementById('addTabBtn');
            tabsContainer.querySelectorAll('.tab').forEach(t => t.remove());
            
            tabs.forEach(tab => {
                const el = document.createElement('div');
                el.className = `tab${tab.id === activeTabId ? ' active' : ''}${tab.modified ? ' modified' : ''}`;
                el.innerHTML = `<span class="tab-name">${tab.name}</span><button class="tab-close">×</button>`;
                
                el.addEventListener('click', e => {
                    if (!e.target.classList.contains('tab-close')) switchTab(tab.id);
                });
                
                el.querySelector('.tab-close').addEventListener('click', e => {
                    e.stopPropagation();
                    closeTab(tab.id);
                });
                
                tabsContainer.insertBefore(el, addBtn);
            });

            setTimeout(updateScrollButtons, 10);
        }

        function switchTab(id) {
            activeTabId = id;
            const tab = tabs.find(t => t.id === id);
            if (tab && editor) editor.setValue(tab.content);
            saveToStorage();
            updateTabUI();
            setTimeout(scrollToActiveTab, 50);
        }

        function addNewTab() {
            const tab = createTab('');
            tabs.push(tab);
            renumberTabs();
            switchTab(tab.id);
        }

        function closeTab(id) {
            if (tabs.length === 1) return;
            const i = tabs.findIndex(t => t.id === id);
            tabs.splice(i, 1);
            renumberTabs();
            if (activeTabId === id) switchTab(tabs[Math.min(i, tabs.length - 1)].id);
            else updateTabUI();
        }

        initTabs();

        scrollLeftBtn.addEventListener('click', () => scrollTabs(-1));
        scrollRightBtn.addEventListener('click', () => scrollTabs(1));
        tabsContainer.addEventListener('scroll', updateScrollButtons);
        window.addEventListener('resize', updateScrollButtons);

        require(['vs/editor/editor.main'], function () {
            monaco.editor.defineTheme('pureBlack', {
                base: 'vs-dark',
                inherit: false,
                rules: [
                    { token: '', foreground: '555555', background: '050505' },
                    { token: 'keyword', foreground: '444444', fontStyle: 'bold' },
                    { token: 'string', foreground: '383838' },
                    { token: 'number', foreground: '404040' },
                    { token: 'comment', foreground: '1a1a1a' },
                    { token: 'delimiter', foreground: '333333' },
                    { token: 'operator', foreground: '3a3a3a' },
                    { token: 'identifier', foreground: '555555' },
                    { token: 'function', foreground: '1a1a1a' },
                    { token: 'predefined', foreground: '151515' },
                ],
                colors: {
                    'editor.background': '#050505',
                    'editor.foreground': '#555555',
                    'editorLineNumber.foreground': '#181818',
                    'editorLineNumber.activeForeground': '#2a2a2a',
                    'editor.selectionBackground': '#111111',
                    'editor.lineHighlightBackground': '#0a0a0a',
                    'editorCursor.foreground': '#333333',
                    'editorIndentGuide.background': '#0f0f0f',
                    'editorIndentGuide.activeBackground': '#1a1a1a',
                    'scrollbarSlider.background': '#0f0f0f',
                    'scrollbarSlider.hoverBackground': '#1a1a1a',
                    'scrollbarSlider.activeBackground': '#222222',
                    'editorWidget.background': '#080808',
                    'editorWidget.border': '#111111',
                    'editorSuggestWidget.background': '#080808',
                    'editorSuggestWidget.border': '#111111',
                    'editorSuggestWidget.foreground': '#444444',
                    'editorSuggestWidget.selectedBackground': '#111111',
                    'editorBracketMatch.background': '#111111',
                    'editorBracketMatch.border': '#222222',
                }
            });

            monaco.languages.register({ id: 'lua' });
            monaco.languages.setMonarchTokensProvider('lua', {
                keywords: ['and','break','do','else','elseif','end','false','for','function','goto','if','in','local','nil','not','or','repeat','return','then','true','until','while'],
                globals: ['print','tonumber','tostring','type','pairs','ipairs','next','select','setmetatable','getmetatable','rawget','rawset','pcall','xpcall','error','assert','require','string','table','math','io','os','coroutine','debug','wait','spawn','game','workspace','script','Instance','Vector3','Vector2','CFrame','Color3','UDim2','Enum','tick','time','typeof','unpack','loadstring'],
                operators: ['+','-','*','/','^','%','#','==','~=','<=','>=','<','>','=',';',':',',','.','..','...'],
                symbols: /[=><!~?:&|+\-*\/\^%#]+/,
                tokenizer: {
                    root: [
                        [/[a-zA-Z_]\w*(?=\s*\()/, { cases: { '@globals': 'predefined', '@default': 'function' }}],
                        [/[a-zA-Z_]\w*/, { cases: { '@keywords': 'keyword', '@globals': 'predefined', '@default': 'identifier' }}],
                        { include: '@whitespace' },
                        [/[{}()\[\]]/, 'delimiter'],
                        [/[;,.]/, 'delimiter'],
                        [/@symbols/, { cases: { '@operators': 'operator', '@default': '' }}],
                        [/\d+\.?\d*([eE][\-+]?\d+)?/, 'number'],
                        [/0[xX][0-9a-fA-F]+/, 'number'],
                        [/"([^"\\]|\\.)*"/, 'string'],
                        [/'([^'\\]|\\.)*'/, 'string'],
                        [/\[(=*)\[[\s\S]*?\]\1\]/, 'string'],
                    ],
                    whitespace: [
                        [/[ \t\r\n]+/, ''],
                        [/--\[(=*)\[[\s\S]*?\]\1\]/, 'comment'],
                        [/--.*$/, 'comment'],
                    ],
                }
            });

            const activeTab = tabs.find(t => t.id === activeTabId);
            
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: activeTab ? activeTab.content : defaultCode,
                language: 'lua',
                theme: 'pureBlack',
                fontSize: 13,
                fontFamily: "'JetBrains Mono','Fira Code','SF Mono',Consolas,monospace",
                lineNumbers: 'on',
                minimap: { enabled: false },
                scrollBeyondLastLine: false,
                automaticLayout: true,
                tabSize: 4,
                cursorBlinking: 'smooth',
                cursorSmoothCaretAnimation: 'on',
                smoothScrolling: true,
                padding: { top: 12, bottom: 12 },
                renderLineHighlight: 'none',
                renderWhitespace: 'none',
                bracketPairColorization: { enabled: false },
                guides: { indentation: false, bracketPairs: false },
                folding: true,
                matchBrackets: 'always',
                autoClosingBrackets: 'always',
                autoClosingQuotes: 'always',
                occurrencesHighlight: false,
                selectionHighlight: false,
                lineDecorationsWidth: 8,
                lineNumbersMinChars: 3,
                glyphMargin: false,
                scrollbar: { 
                    verticalScrollbarSize: 5, 
                    horizontalScrollbarSize: 5,
                    useShadows: false
                }
            });

            editor.onDidChangeModelContent(() => {
                const tab = tabs.find(t => t.id === activeTabId);
                if (tab) {
                    tab.content = editor.getValue();
                    tab.modified = true;
                    saveToStorage();
                    updateTabUI();
                }
            });

            editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyS, () => {
                const tab = tabs.find(t => t.id === activeTabId);
                if (tab) {
                    tab.modified = false;
                    saveToStorage();
                    updateTabUI();
                }
            });
            
            editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyN, addNewTab);
            editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyW, () => closeTab(activeTabId));

            updateTabUI();
        });

        document.getElementById('addTabBtn').addEventListener('click', addNewTab);
    </script>
</body>
</html>